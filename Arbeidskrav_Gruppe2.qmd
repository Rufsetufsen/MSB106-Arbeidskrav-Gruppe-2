---
title: "Arbeidskrav i Regional økonomi"
author: "Gruppe 2"
institute: "HVL"
date: last-modified
date-format: "dddd D MMM, YYYY"
abstract: ""
number-sections: true
number-depth: 3
lang: NO_nb
csl: apa7.csl
crossref:
  fig-prefix: figur
  tbl-prefix: tabell
  fig-title: Figur
  tbl-title: Tabell
  lof-title: "Figurliste"
  lot-title: "Tabelliste"
format:
  html: default
  typst:
    papersize: a4
    toc: true
    toc-title: Innholdsfortegnelse
    documentclass: article
    number-sections: true
    keep-tex: true
    fig-pos: "H"
    output-file: "Arbeidskrav_Gruppe2"
    citeproc: true
  pdf:
    documentclass: article
    toc:  true
    toc-title: Innholdsfortegnelse
    number-sections: true
    keep-tex: true
    papersize: A4
    fig-pos: "H"
    output-file: "Arbeidskrav_Gruppe2"
editor_options:
  markdown:
    wrap: 72
    canonical: true
    chunk_output_type: console
echo: false
eval: true
bibliography: ArbRef.bib
nocite: '@*'
---

```{r}
#| label: setup
#| message: false
#| warning: false
library(tidyverse)
library(readxl)
library(sf)
library(spdep)
library(writexl)
library(PxWebApiData)
library(modelsummary)
library(knitr)
library(lubridate)
library(flextable)
library(dplyr)
options(
  paged.print = FALSE,
  scipen = 999
  )
```

```{r}
#| eval: false
# Lage en bib fil for brukte R pakker 
# NB når denne blir kjørt slettes bib filen, og blir laget på nytt
# må da legge inn vanlige kilder på nytt
packs <- c(
  "knitr",
  "tidyverse",
  "readxl",
  "sf",
  "spdep",
  "writexl",
  "modelsummary",
  "lubridate",
  "PxWebApiData",
  "flextable",
  "dplyr"
  )
write_bib(
  packs,
  file = "ArbRef.bib"
  )
rm(packs)
```

```{r}
load("nor_knr24_vec.rdata")
load("newknr.rdata")
load("bef.rdata")
load("demografi.rdata")
load("demografi_total.rdata")
load("bolig.rdata")
load("utdanning.rdata")
load("flytt.rdata")
load("pendl.rdata")
load("Sentralitet.rdata")
load("arbledighet.rdata")
load("syss.rdata")
load("syssendr0024.rdata")
```

# Datainnhenting

## Folketall

## Demografiske data

## Sentralitetsindeksen for norske kommuner

Sentralitetsindeksen er en kode som beskriver hver kommunes sentralitet.
Beregningen av sentralitetsindeksen er basert på reisetid til
arbeidsplasser og servicefunksjoner fra alle bebodde grunnkretser.
Indeksen er sammensatt av to del-indekser:

-   Antall arbeidsplasser de som bor i den enkelte grunnkrets kan nå med
    bil i løpet av 90 minutter.
-   Hvor mange ulike typer servicefunksjoner (varer og tjenester) de som
    bor i den enkelte grunnkrets kan nå med bil i løpet av 90 minutter.

Antallet vektes, slik at en arbeidsplass eller servicefunksjon som
ligger nært bostedet teller mer enn en som ligger lenger bort. Indeksen
fordeles på en kontinuerlig skala fra 0 (minst sentral) til 1000 (mest
sentral), og fordeles så inn i 6 forskjellige sentralitetsklasser,
basert på kommunens sentralitetsverdi.

Endringer fra 2017 -\> 2020 og 2024 skyldes (i følge SSB selv) i stor
grad endringer i kommunegrensene . I perioden har det vært flere
kommuneoppløsninger/sammenslåinger, og indeksen vil påvirkes ved hver
slik grensejustering [@høydahl, s. 22]. I 2017 (ved første kalkulering
av indeksen), ble det også gjort noen feil i databehandlingen som senere
har blitt rettet opp i. Ved èn kjøring av dataeksport ble det satt en
cutoff på antall arbeidsplasser den enkelte kunne nå innen 60 minutter i
stedet for de 90 som indeksen skulle baseres på. Dette påvirket
resultatet svært mye for de aktuelle områdene (Hordaland, Sogn og
Fjordane, Møre og Romsdal, Trøndelag og Nord-Norge).

## Prosentvis arbeidsledighet

Arbeidsledighet kan defineres som andelen av et lands arbeidsstyrke som
ikke er i arbeid, men som aktivt søker jobb og er tilgjengelig for å
starte. I Norge publiserer både NAV og Statistik sentralbyrå (SSB) tall
for arbeidsledighet, men bruker ulike metoder når det kommer til å samle
inn data. **Kilde: https://arbeidsledighet.no/sporsmal-og-svar/**

NAVs tall omfatter personer som er registrert som helt ledigh hos NAV.
Dette er en fulltelling av alle som faktisk har meldt seg som
arbeidssøkere i NAVs systemer. SSB derimot, måler arbeidsledighet
gjennom Arbeidskraftundersøkelsen (AKU), som er en intervjuundersøkelse
basert på et representativt utvalg av hele befolkningen.

Begge benytter de samme grunnleggende kriteriene for hva som regnes som
arbeidsledihhet. Forskellen i tall skyldes først og fremst
innsamlongsmetoden. SSB inkluderer også personer som er uten arbeid og
aktivt søker jobb. Flere av disse kan være personer som ikke er
registrert hos NAV. Dette fører til at SSB rapporterer et høyere
ledighetstall enn NAV.

NAVs tall gir derimot et bedre bilde av hvor mange som faktisk mottat og
har behov for oppføring fra et statlig organ, mens SSBs tall gir et
bredere og mer helhetlig bilde av arbeidsledigheten i befolkningen som
helhet.

**Kilde:
https://www.ssb.no/arbeid-og-lonn/sysselsetting/artikler/hvorfor-ulike-arbeidsledighetstall**

## Sysselsetting

## Gjennomsnittlig kvadratmeterpris for bolig

## Utdanningsnivå

## Ut- og innflyttinger pr 1000 innbyggere

## Inn- og utpendling

# Resultater

## Kart

### Folketallsvekst

![Prosentvis folketallsvekst etter år
2000](./data/Prosentvis_folketallsvekst_etter_år_2000.png){#fig-BefolkningVekstKart}

Den prosentvise folketallsveksten etter år 2000, til 2024, kan ses i
@fig-BefolkningVekstKart. Her kan man se at det er ett fåtall kommuner
som har klasse 6 eller høyere. Der er flere kommuner i Akershus med
forholdsvis høy befolkningsvekts, for eksempel Gjerdrum, Nannestad og
Eidsvoll. Ullensaker har hatt høyest vekst i landet. Kystområdene sør i
landet har generelt sett hatt høyere vekst enn innlandet og Nord-Norge.
De kommunene med lavest vekst ligger for det meste i Trøndelag og lengre
nord i landet.

### Andel befolkning i alder 20-29

![Andel befolkning i alder 20-29 i
2024](./data/Andel_befolkning_i_alder_20-29_i_2024.png){#fig-Andelbef}

I @fig-Andelbef vises andel av befolkningen i aldersgruppen 20-29 i
2024. Her er det høyest andel i Troms, og en del plasser i Finnmark har
høy andel i aldersgruppen. Det er noen kommuner i landet med spesielt
høy andel (18%), for eksempel en kommune i Trøndelag, Oslo, og noen
steder vest i landet.

### Arbeidsledighet og sysselsettingsvekst

![Andel arbeidsledighet i år
2024](./data/Andel_arbeidsledighet_i_år_2024.png){#fig-Arbledighet}

![Prosentvis sysselsettingsvekst etter år
2000](./data/Prosentvis_sysselsettingsvekst_etter_år_2000.png){#fig-SysselVekst}

@Fig-Arbledighet viser et kart over arbeidsledigheten i Norge i 2024.
Kartet viser få uteliggere med høy arbeidsledighet. Høyest
arbeidsledighet er i Finnmark, men man kan finne en uteligger i
Nordland. Det er også mer arbeidsledighet i området rundt og i Akershus
enn vest i landet. Videre i @fig-SysselVekst kan man se prosentvis
sysselsettingsvekst etter år 2000, til 2024. Her kan man se at det har
både vært negativ og positiv vekt i landet. Igjen kommer kystområdene i
Sør-Norge, samt områdene rundt og i Oslo godt ut, og har en høy klasse
vekst. Innlandet og nordover i landet har en del negativ vekst. Hamarøy
skiller seg spesielt ut og har klasse 10 vekst, selv om nabo kommunene
har svak eller negativ vekst.

### Andel med universitetsutdanning

![Andelen av innbyggerne med universitetsutdanning i
2024](./data/Andelen_av_innbyggerne_med_universitetsutdanning_i_2024.png){#fig-Universitetand}

Andelen av innbyggere med universitetsutdanning i 2024 kan ses i
@fig-Universitetand. Her er det blant annet en høy andel i området i og
rundt Oslo. Det er flere kommuner med forholdsvis lav andel (under
17,8%), men de fleste kommunene har en andel over den første klassen.

### Netto utflytting

![Netto utflytting per 1000
innbyggere](./data/Netto_utflytting_per_1000_innbyggere.png){#fig-Utflytting}

I @fig-Utflytting kan man se netto utflytting per 1000 innbyggere. Her
viser rødt til netto utflytting, mens blått er netto innflytting. De
fleste kommunene er blå, og dermed har netto innflytting. Det er noen
kommuner som har spesielt høy utflytting, for eksempel Engerdal, Vang og
Snåsa.

### Netto innpendling og kvm. pris for eneboliger

![Netto innpendling per 1000
arbeidsplasser](./data/Netto_innpendling_per_1000_arbeidsplasser.png){#fig-Pendlingarb}

![Gjennomsnittlig kvm. pris for eneboliger i
2024](./data/Gjennomsnittlig_kvm._pris_for_eneboliger_i_2024.png){#fig-KvmprisEne}

Netto pendling per 1000 arbeidsplasser vises i @fig-Pendlingarb. Her
viser rødt til kommuner med mer utpendling enn innpendling, mens blå
viser til det motsatte. Det er mest høyest grad av utpendling i
Østlandet, spesielt i Akershus. Det er minst kommuner med mer
innpendling enn utpendling, disse kommunene er spredt over hele landet.
Noen av disse kommunene er derimot rett vedsiden av kommunene med mest
utpendling, som tyder på at arbeiderne pendler mye til nabokommunene.
@Fig-KvmprisEne viser den gjennomsnittlige kvadratmeter prisen for
eneboliger i 2024. Det er en del manglende data for priser. I og rundt
Oslo er det spesielt høy pris per kvm. Det samme gjelder blant annet for
noen kommuner nord i Norge. Man kan se at det er høyere priser ved
kysten enn midt i landet. Den høye innpendlingen i Oslo kan være ett
resultat av den høye kvadratmeterprisen for eneboliger.

## Kurver

```{r}
# Laster inn rdata-filene vi skal bruke til å lage kurver.
load("bolig2.rdata")
```

### Gjennomsnittlig folketall per sentralitetsklasse

```{r, warning=FALSE, message=FALSE}
bef_merged <- bef %>%
  left_join(Sentralitet %>% select(kommunenummer, `Klasse 2023`), 
            by = "kommunenummer")
# Gjennomsnittlig folketall per sentralitetsklasse - med facets (for lesbarhet)
bef_snitt <- bef_merged %>%
  filter(år > 2000) %>%
  filter(!is.na(`Klasse 2023`)) %>%
  mutate(år = as.numeric(as.character(år))) %>%  # Konverter år til numerisk
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_folketall = mean(beftot, na.rm = TRUE),
            .groups = "drop")

ggplot(bef_snitt, aes(x = år, y = gjsnitt_folketall)) +
  geom_line(linewidth = 1, color = "steelblue") +
  geom_point(size = 2, color = "steelblue") +
  facet_wrap(~ `Klasse 2023`, 
             scales = "free_y",
             labeller = labeller(`Klasse 2023` = c(
               "1" = "Klasse 1 (mest sentral)",
               "2" = "Klasse 2",
               "3" = "Klasse 3",
               "4" = "Klasse 4",
               "5" = "Klasse 5",
               "6" = "Klasse 6 (minst sentral)"
             ))) +
  scale_x_continuous(breaks = seq(2000, 2025, by = 5)) +
  labs(title = "Folketallsutvikling etter sentralitetskategori",
       subtitle = "Gjennomsnittlig folketall per kommune, 2001-",
       x = "År",
       y = "Gjennomsnittlig folketall") +
  theme_minimal() +
  theme(strip.text = element_text(face = "bold"),
        axis.text.x = element_text(angle = 45, hjust = 1))
```

### Andel innbyggere 20-29 år etter sentralitetskategori

```{r, warning=FALSE, message=FALSE}
# Merge aldersdata med sentralitetsdata
demo_merged <- demografi_total %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(Sentralitet %>% select(kommunenummer, `Klasse 2023`), 
            by = "kommunenummer") %>%
  filter(!is.na(`Klasse 2023`))

# Beregne totalt folketall per kommune per år (for å regne ut andeler)
demo_totalt <- demo_merged %>%
  filter(år > 2000) %>%
  group_by(kommunenummer, år, `Klasse 2023`) %>%
  summarise(totalt_bef = sum(bef, na.rm = TRUE),
            .groups = "drop")

# Merge tilbake og beregne andeler
demo_andeler <- demo_merged %>%
  filter(år > 2000) %>%
  left_join(demo_totalt, by = c("kommunenummer", "år", "Klasse 2023")) %>%
  mutate(andel = bef / totalt_bef * 100)

# Kun aldersgruppen 20-29
demo_snitt_20_29 <- demo_andeler %>%
  filter(aldersgruppe == "20-29") %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_andel = mean(andel, na.rm = TRUE),
            .groups = "drop")

# Lage graf
ggplot(demo_snitt_20_29, aes(x = år, y = gjsnitt_andel)) +
  geom_line(linewidth = 1, color = "steelblue") +
  geom_point(size = 2, color = "steelblue") +
  facet_wrap(~ `Klasse 2023`, 
             scales = "free_y",
             labeller = labeller(`Klasse 2023` = c(
               "1" = "Klasse 1 (mest sentral)",
               "2" = "Klasse 2",
               "3" = "Klasse 3",
               "4" = "Klasse 4",
               "5" = "Klasse 5",
               "6" = "Klasse 6 (minst sentral)"
             ))) +
  scale_x_continuous(breaks = seq(2000, 2025, by = 5)) +
  labs(title = "Andel innbyggere 20-29 år etter sentralitetskategori",
       subtitle = "Gjennomsnittlig andel per kommune, 2001-",
       x = "År",
       y = "Andel av befolkningen (%)") +
  theme_minimal() +
  theme(strip.text = element_text(face = "bold"))
```

### Arbeidsledighet etter sentralitetskategori

```{r, warning=FALSE, message=FALSE}
aled_merged <- arbledighet %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(Sentralitet %>% select(kommunenummer, `Klasse 2023`), 
            by = "kommunenummer") %>%
  filter(!is.na(`Klasse 2023`))

# Beregne gjennomsnittlig arbeidsledighet per sentralitetsklasse per år (etter 2008)
aled_snitt <- aled_merged %>%
  filter(år > 2008) %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_ledighet = mean(prosent_ledige_i_året, na.rm = TRUE),
            .groups = "drop")

# Lage graf - alle klasser i samme plot
ggplot(aled_snitt, aes(x = år, y = gjsnitt_ledighet, 
                        color = factor(`Klasse 2023`),
                        group = `Klasse 2023`)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(2009, 2025, by = 2)) +
  scale_color_discrete(name = "Sentralitetsklasse",
                       labels = c("1 (mest sentral)", "2", "3", "4", "5", "6 (minst sentral)")) +
  labs(title = "Arbeidsledighet etter sentralitetskategori",
       subtitle = "Gjennomsnittlig prosent arbeidsledige per kommune, 2009-",
       x = "År",
       y = "Arbeidsledighet (%)") +
  theme_minimal() +
  theme(legend.position = "right")
```

### Sysselsettingsvekst etter sentralitetskategori

```{r, warning=FALSE, message=FALSE}
# Merge sysselsettingdata med sentralitetsdata
syss_merged <- syss %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(Sentralitet %>% select(kommunenummer, `Klasse 2023`), 
            by = "kommunenummer") %>%
  filter(!is.na(`Klasse 2023`))

# Beregne totalt antall sysselsatte per sentralitetsklasse per år
syss_totalt <- syss_merged %>%
  filter(år > 2000) %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(totalt_sysselsatte = sum(Arbeidssted, na.rm = TRUE),
            .groups = "drop")

# Beregne prosentvis vekst år til år
syss_vekst <- syss_totalt %>%
  arrange(`Klasse 2023`, år) %>%
  group_by(`Klasse 2023`) %>%
  mutate(vekst_prosent = (totalt_sysselsatte - lag(totalt_sysselsatte)) / lag(totalt_sysselsatte) * 100) %>%
  ungroup() %>%
  filter(!is.na(vekst_prosent))  # Fjerner første år (ingen vekst å beregne)

# Lage graf - alle klasser i samme plot
ggplot(syss_vekst, aes(x = år, y = vekst_prosent, 
                        color = factor(`Klasse 2023`),
                        group = `Klasse 2023`)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  scale_x_continuous(breaks = seq(2000, 2025, by = 3)) +
  scale_color_discrete(name = "Sentralitetsklasse",
                       labels = c("1 (mest sentral)", "2", "3", "4", "5", "6 (minst sentral)")) +
  labs(title = "Sysselsettingsvekst etter sentralitetskategori",
       subtitle = "Prosentvis endring fra forrige år, 2001-",
       x = "År",
       y = "Sysselsettingsvekst (%)") +
  theme_minimal() +
  theme(legend.position = "right")
```

### Kvadratmeterpris bolig

```{r, warning=FALSE, message=FALSE}
# Merge boligdata med sentralitetsdata
bolig_merged <- bolig2 %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(Sentralitet %>% select(kommunenummer, `Klasse 2023`), 
            by = "kommunenummer") %>%
  filter(!is.na(`Klasse 2023`))

# Beregne vektet gjennomsnittlig kvadratmeterpris per sentralitetsklasse per år (etter 2002)
# Vektes med antall omsetninger
bolig_vektet <- bolig_merged %>%
  filter(år > 2002) %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(vektet_kvpris = sum(kvpris * antall_omsetninger, na.rm = TRUE) / 
                            sum(antall_omsetninger, na.rm = TRUE),
            .groups = "drop")

# Lage graf - alle klasser i samme plot
ggplot(bolig_vektet, aes(x = år, y = vektet_kvpris, 
                          color = factor(`Klasse 2023`),
                          group = `Klasse 2023`)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(2003, 2025, by = 3)) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_discrete(name = "Sentralitetsklasse",
                       labels = c("1 (mest sentral)", "2", "3", "4", "5", "6 (minst sentral)")) +
  labs(title = "Utviklingen i kvadratmeterpriser for boliger etter sentralitetskategori",
       subtitle = "Vektet gjennomsnitt (alle boligtyper), 2003-",
       x = "År",
       y = "Kvadratmeterpris (kr)") +
  theme_minimal() +
  theme(legend.position = "right")
```

```{r, warning=FALSE, message=FALSE}
# Vektet pris per boligtype
bolig_vektet_type <- bolig_merged %>%
  filter(år > 2002) %>%
  group_by(år, `Klasse 2023`, boligtype_txt) %>%
  summarise(vektet_kvpris = sum(kvpris * antall_omsetninger, na.rm = TRUE) / 
                            sum(antall_omsetninger, na.rm = TRUE),
            .groups = "drop")

ggplot(bolig_vektet_type, aes(x = år, y = vektet_kvpris, 
                               color = factor(`Klasse 2023`),
                               linetype = boligtype_txt,
                               group = interaction(`Klasse 2023`, boligtype_txt))) +
  geom_line(linewidth = 1) +
  geom_point(size = 1.5) +
  scale_x_continuous(breaks = seq(2003, 2025, by = 3)) +
  scale_y_continuous(labels = scales::comma) +
  scale_color_discrete(name = "Sentralitetsklasse",
                       labels = c("1 (mest sentral)", "2", "3", "4", "5", "6 (minst sentral)")) +
  scale_linetype_discrete(name = "Boligtype") +
  labs(title = "Utviklingen i kvadratmeterpriser for boliger etter sentralitetskategori",
       subtitle = "Vektet gjennomsnitt etter boligtype, 2003-",
       x = "År",
       y = "Kvadratmeterpris (kr)") +
  theme_minimal() +
  theme(legend.position = "right")
```

### Utvikling i utdanning

```{r, warning=FALSE, message=FALSE}
# Merge utdanningsdata med sentralitetsdata
utd_merged <- utdanning %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(
    Sentralitet %>% 
      select(kommunenummer, `Klasse 2023`) %>%
      distinct(kommunenummer, .keep_all = TRUE),  # Tar kun første forekomst av hver kommune
    by = "kommunenummer"
  ) %>%
  filter(!is.na(`Klasse 2023`))

# Beregne gjennomsnittlig andel per sentralitetsklasse per år
utd_snitt <- utd_merged %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_andel = mean(utdanand, na.rm = TRUE),
            .groups = "drop")

# Lage graf - alle klasser i samme plot
ggplot(utd_snitt, aes(x = år, y = gjsnitt_andel, 
                       color = factor(`Klasse 2023`),
                       group = `Klasse 2023`)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(1970, 2025, by = 5)) +
  scale_color_discrete(name = "Sentralitetsklasse",
                       labels = c("1 (mest sentral)", "2", "3", "4", "5", "6 (minst sentral)")) +
  labs(title = "Andel innbyggere med universitetsutdanning etter sentralitetskategori",
       subtitle = "Gjennomsnittlig andel per kommune (kort + lang), 1971-",
       x = "År",
       y = "Andel med universitetsutdanning (%)") +
  theme_minimal() +
  theme(legend.position = "right")

```

### Utvikling i netto innflytting

```{r, warning=FALSE, message=FALSE}
flytt_merged <- flytt %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(
    Sentralitet %>% 
      select(kommunenummer, `Klasse 2023`) %>%
      distinct(kommunenummer, .keep_all = TRUE),
    by = "kommunenummer"
  ) %>%
  filter(!is.na(`Klasse 2023`))

# Beregne netto utflytting (negativt nettoflytt = utflytting)
# Beregne gjennomsnitt per sentralitetsklasse per år (etter 2010)
flytt_snitt <- flytt_merged %>%
  filter(år > 2010) %>%
  mutate(netto_utflytt = -nettoflyttper1000) %>%  # Gjør om til utflytting (positiv verdi = netto utflytting)
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_netto_utflytt = mean(netto_utflytt, na.rm = TRUE),
            .groups = "drop")

# Lage fasettert graf
ggplot(flytt_snitt, aes(x = år, y = gjsnitt_netto_utflytt)) +
  geom_line(linewidth = 1, color = "steelblue") +
  geom_point(size = 2, color = "steelblue") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  facet_wrap(~ `Klasse 2023`, 
             scales = "free_y",
             labeller = labeller(`Klasse 2023` = c(
               "1" = "Klasse 1 (mest sentral)",
               "2" = "Klasse 2",
               "3" = "Klasse 3",
               "4" = "Klasse 4",
               "5" = "Klasse 5",
               "6" = "Klasse 6 (minst sentral)"
             ))) +
  scale_x_continuous(breaks = seq(2011, 2025, by = 3)) +
  labs(title = "Netto utflytting etter sentralitetskategori",
       subtitle = "Gjennomsnittlig netto utflytting per kommune, 2011-",
       x = "År",
       y = "Netto utflytting (antall personer)") +
  theme_minimal() +
  theme(strip.text = element_text(face = "bold"))
```

### Utvikling i netto innpendling

```{r, warning=FALSE, message=FALSE}
pendl_merged <- pendl %>%
  mutate(år = as.numeric(as.character(år))) %>%
  left_join(
    Sentralitet %>% 
      select(kommunenummer, `Klasse 2023`) %>%
      distinct(kommunenummer, .keep_all = TRUE),
    by = "kommunenummer"
  ) %>%
  filter(!is.na(`Klasse 2023`))

# Beregne gjennomsnittlig netto innpendling per sentralitetsklasse per år (etter 2000)
pendl_snitt <- pendl_merged %>%
  filter(år > 2000) %>%
  group_by(år, `Klasse 2023`) %>%
  summarise(gjsnitt_nettopend = mean(nettopend, na.rm = TRUE),
            .groups = "drop")

# Lage fasettert graf
ggplot(pendl_snitt, aes(x = år, y = gjsnitt_nettopend)) +
  geom_line(linewidth = 1, color = "steelblue") +
  geom_point(size = 2, color = "steelblue") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  facet_wrap(~ `Klasse 2023`, 
             scales = "free_y",
             labeller = labeller(`Klasse 2023` = c(
               "1" = "Klasse 1 (mest sentral)",
               "2" = "Klasse 2",
               "3" = "Klasse 3",
               "4" = "Klasse 4",
               "5" = "Klasse 5",
               "6" = "Klasse 6 (minst sentral)"
             ))) +
  scale_x_continuous(breaks = seq(2001, 2025, by = 5)) +
  labs(title = "Netto innpendling etter sentralitetskategori",
       subtitle = "Gjennomsnittlig netto innpendling per kommune, 2001-",
       x = "År",
       y = "Netto innpendling (antall personer)") +
  theme_minimal() +
  theme(strip.text = element_text(face = "bold"))
```

## Korrelasjoner

# Litteraturliste

::: {#refs}
:::

\listoffigures
\listoftables
